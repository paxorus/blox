<html><head><style>
#button{background-color:#08F;color:white;font-size:36px;font-family:Calibri;padding:5px;position:absolute;left:50%;margin-left:-100px;top:250px;width:200px;text-align:center;}
#button:hover{text-shadow:0 0 20px orange;color:orange;}
#input,#out{width:500px;height:200px;position:absolute;left:50%;margin-left:-250px;}
#input{top:40px;}
#out{top:320px;}
</style></head>
<body>
The only requirement for the input is proper punctuation and spacing.<br />
<textarea placeholder="Type here..." id="input">By late 1944, both the Red Army and the Western Allies were advancing into Germany. Recognising the strength and determination of the Red Army, Hitler decided to use his remaining mobile reserves against the American and British troops, which he perceived as far weaker. [276] On 16 December, he launched an offensive in the Ardennes to incite disunity among the Western Allies and perhaps convince them to join his fight against the Soviets. [277] The offensive failed. Hitler's hope to negotiate peace with the United States and Britain was buoyed by the death of Franklin D. Roosevelt on 12 April 1945, but contrary to his expectations, this caused no rift among the Allies. [278][277] Acting on his view that Germany's military failures had forfeited its right to survive as a nation, Hitler ordered the destruction of all German industrial infrastructure before it could fall into Allied hands. [279] Arms minister Albert Speer was entrusted with executing this scorched earth plan, but he secretly disobeyed the order. [279][280]</textarea>
    
<span onclick="lilahify(input.value)" id="button">Lilahify This!</span>
<textarea readonly id="out"></textarea>
</body>

<script src="lilah_text.js"></script>
<script>
var out=document.getElementById("out");
var hash=hashAll();

// set out.value to mutilated version
function lilahify(input){
	var inp_words=input.split(" ");
	var result=[];

	// swap at words in hash
	for(var i=0;i<inp_words.length;i++){
		// build sentence[]
		var sentence=[];
		while(!punctuated(inp_words[i])){
			sentence.push(inp_words[i++]);
		}
		sentence.push(inp_words[i++]);
		result.push(mutate(sentence));
		// break;
	}
	
	out.value=result.join(" ");
}

function hashAll(){// one-time run
	var hash={};
	for(var i=0;i<texts.length;i++){
		var words=texts[i].split(" ");
		for(var j=0;j<words.length;j++){
			if(hash[words[j]]){
				hash[words[j]].push(i);
			}else{
				hash[words[j]]=[i];
			}
		}
	}
	return hash;
}

// given sentence[], find two words to swap along
function mutate(sentence){// user words
	console.log(sentence);
	var ends=chooseEnds(sentence);
	if(ends[1]===undefined){// input has only one sticky end
		return sentence.join(" ");
	}
	var start=getOccurrence(sentence[ends[0]],true);
	var end=getOccurrence(sentence[ends[1]],false);

	// build mutant
	var center=[];
	for(var i=ends[0]+1;i<ends[1];i++){
		center.push(sentence[i]);
	}
	var mutant=start+" "+center.join(" ")+" "+end;
	return mutant;
}

function chooseEnds(sentence){
	// push all words that are in hash
	var swappable=[];
	for(var i=0;i<sentence.length;i++){
		if(hash.hasOwnProperty(sentence[i])){
			swappable.push(i);
		}
	}
	// pick two randomly
	var ind=Math.floor(Math.random()*swappable.length);
	var temp=swappable.splice(ind,1);
	var ind2=Math.floor(Math.random()*swappable.length);
	swappable.splice(ind,0,temp[0]);

	if(ind<=ind2){
		ind2++;// affected by splicing shift
		return [swappable[ind],swappable[ind2]];
	}else{// ind2<ind
		return [swappable[ind2],swappable[ind]];
	}
}

function getOccurrence(word,if_start){
	var occur=hash[word];
	occur=occur[Math.floor(Math.random()*occur.length)];// random pick from hash value
	occur=texts[occur];// get sentence
	var ind=occur.indexOf(word);
	if(if_start){
		return occur.substring(0,ind+word.length);
	}else{
		return occur.substring(ind);
	}
}

// a=[a b], return any duplicates
function concatenate(a,b,dup){
	for(var i=0;i<b.length;i++){
		if(a.indexOf(b)==-1){
			a.push(b[i]);
		}else{
			dup.push(b[i]);
		}
	}
}

function punctuated(token){
	var c=token[token.length-1];
	return ".?!".indexOf(c)>-1
}

</script>


</html>